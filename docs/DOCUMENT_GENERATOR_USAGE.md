# document_generator ツールの使い方

## 概要

`document_generator` は、LLMが生成した任意のテキストをPDF/テキスト形式で保存するシンプルな変換ツールです。

## リファクタリングの背景

### 以前の設計（テンプレートベース）
- 事前定義されたテンプレートに基づいて文書を生成
- 文書タイプ（申入書、見積書など）ごとに固定のフォーマット
- カスタマイズ性が低く、柔軟性に欠ける

### 新しい設計（LLM生成 + PDF変換）
- LLMが任意の文書内容を生成
- ツールは生成されたテキストをPDF化するだけ
- 柔軟性が高く、あらゆる種類の文書に対応可能

## 使い方

### 2ステップのプロセス

1. **LLMが文書内容を生成**（推奨: Sonnet）
   - 強力なモデル（Sonnet）を使用して高品質な文書を生成
   - 文書の構造、内容、トーンをLLMが完全にコントロール

2. **ツールがPDF化**
   - 生成されたテキストをPDF/テキスト形式で保存
   - 日本語フォント対応（Windows/macOS/Linux）
   - A4サイズ、20mmマージン

### 関数シグネチャ

```python
@tool
def generate_document(
    content: str,      # PDF化したい文書内容（LLMが生成したテキスト）
    title: str,        # 文書タイトル（PDFのヘッダーとファイル名に使用）
    format: str = "pdf"  # 出力形式: "pdf" or "txt"
) -> str:
```

### 使用例

#### 例1: 価格交渉申入書のPDF化

```python
# ステップ1: LLM（Sonnet）が文書内容を生成
business_letter = """
価格改定のお願い

株式会社サンプル商事 御中

平素より格別のご高配を賜り、厚く御礼申し上げます。

━━━━━━━━━━━━━━━━━━━━━━━━━━━━
【改定理由】
━━━━━━━━━━━━━━━━━━━━━━━━━━━━

1. 原材料費の高騰
   鉄鋼材料費が前年比20%上昇しております。

2. エネルギーコストの増加
   電力料金が前年比30%上昇しております。
...
"""

# ステップ2: ツールがPDF化
result = generate_document(
    content=business_letter,
    title="価格改定のお願い",
    format="pdf"
)
```

#### 例2: 見積書のPDF化

```python
# LLMが見積書の全文を生成
quotation = """
御見積書

株式会社サンプル商事 御中

見積番号：Q-20250201-A123
...
"""

# PDF化
result = generate_document(
    content=quotation,
    title="御見積書",
    format="pdf"
)
```

#### 例3: テキスト形式で保存

```python
# 議事録をテキスト形式で保存
minutes = """
会議議事録

日時：2025年2月1日
...
"""

result = generate_document(
    content=minutes,
    title="会議議事録_20250201",
    format="txt"
)
```

## モデル指定について

### なぜ別モデルを使用するか？

- **文書生成は高品質モデル（Sonnet）を推奨**
  - 複雑なビジネス文書の構造を理解
  - 適切なトーンと表現を選択
  - 文脈を考慮した内容生成

- **PDF変換ツールはシンプル**
  - 単純な変換処理のみ
  - モデルの性能は不要

### Strandsエージェントでの実装例

Mode 2エージェント（価格転嫁専門家）がこのツールを使用する場合：

```python
# agent/mode2.py での実装イメージ

from strands import Agent

# Mode 2エージェント: 価格転嫁専門家
mode2_agent = Agent(
    name="価格転嫁専門家",
    model="sonnet",  # 文書生成に強力なモデルを使用
    tools=[
        generate_document,  # PDF変換ツール
        # 他のツール...
    ],
    instructions="""
    あなたは中小企業向け価格転嫁支援の専門家です。

    文書生成時の手順：
    1. まず、文書内容を完全に生成してください（あなたのSonnetモデルで）
    2. 生成した内容を generate_document ツールでPDF化してください

    【重要】
    - 文書の品質はあなた（Sonnet）が担保します
    - ツールは変換のみを行います
    """
)
```

## PDF生成の特徴

### 日本語フォント対応
- Windows: MSゴシック、MS明朝、メイリオ
- macOS: ヒラギノ角ゴシック、Arial Unicode
- Linux: Noto Sans CJK

### レイアウト
- ページサイズ: A4
- マージン: 上下左右20mm
- 自動見出し検出:
  - `━` を含む行 → 見出しスタイル
  - `【】` を含む行 → 見出しスタイル
  - その他 → 本文スタイル

### フォールバック機能
- PDF生成に失敗した場合、自動的にテキスト形式で保存

## 出力先

生成された文書は `documents/` ディレクトリに保存されます：

```
documents/
  ├── 価格改定のお願い_dbd21e2f.pdf
  ├── 御見積書_fa0e8255.pdf
  └── 会議議事録_20250201_2dc00b76.txt
```

ファイル名形式: `{タイトル}_{UUID8文字}.{拡張子}`

## テスト

シンプルなテストスクリプト:

```bash
python test_document_generator_simple.py
```

このテストは3つのケースをカバー：
1. ビジネスレターのPDF化
2. 見積書のPDF化
3. テキスト形式での保存

## まとめ

- **シンプルな設計**: LLM生成 → PDF変換の2ステップ
- **高い柔軟性**: あらゆる種類の文書に対応
- **モデル分離**: 文書生成はSonnet、変換はシンプルなツール
- **日本語完全対応**: フォント、レイアウト、エンコーディング
