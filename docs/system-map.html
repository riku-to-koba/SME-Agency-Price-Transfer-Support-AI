<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>価格転嫁支援AI - システム完全マップ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Yu Gothic', 'Hiragino Sans', sans-serif;
            background: #f5f5f5;
            padding: 0;
            min-height: 100vh;
            color: #1a1a1a;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 60px 40px;
        }

        h1 {
            text-align: center;
            color: #1a1a1a;
            margin-bottom: 16px;
            font-size: 3em;
            font-weight: 700;
            letter-spacing: -1.5px;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 60px;
            font-size: 1.1em;
            font-weight: 400;
        }

        .flow-section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 1.8em;
            color: #1a1a1a;
            margin-bottom: 32px;
            margin-top: 60px;
            padding: 0;
            text-align: left;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .user-box, .orchestrator-box, .mode-box {
            padding: 32px;
            border-radius: 12px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.1em;
            font-weight: 500;
            background: #ffffff;
            border: 1px solid #d4d4d4;
            transition: all 0.2s ease;
            color: #1a1a1a;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .user-box:hover, .orchestrator-box:hover, .mode-box:hover {
            border-color: #999;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
        }

        .arrow {
            text-align: center;
            font-size: 1.5em;
            color: #d4d4d4;
            margin: 16px 0;
        }

        .split-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .phase-box {
            padding: 28px;
            border-radius: 12px;
            background: #ffffff;
            border: 1px solid #d4d4d4;
            transition: all 0.2s ease;
            color: #1a1a1a;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .phase-box:hover {
            border-color: #999;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
        }

        .phase-box h3 {
            font-size: 1.4em;
            margin-bottom: 16px;
            font-weight: 700;
            letter-spacing: -0.5px;
            color: #1a1a1a;
        }

        .steps-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .step-card {
            padding: 24px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            background: #ffffff;
            border: 1px solid #d4d4d4;
            position: relative;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .step-card:hover {
            border-color: #666;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.12);
            transform: translateY(-2px);
        }

        .step-card.important {
            border-color: #f59e0b;
            background: #fef3c7;
            box-shadow: 0 2px 6px rgba(245, 158, 11, 0.15);
        }

        .step-card.important::after {
            content: '★';
            position: absolute;
            top: 12px;
            right: 12px;
            font-size: 1em;
            color: #fbbf24;
        }

        .step-number {
            font-size: 0.8em;
            font-weight: 600;
            margin-bottom: 8px;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .step-title {
            font-size: 1.1em;
            margin-bottom: 8px;
            font-weight: 600;
            color: #1a1a1a;
        }

        .step-purpose {
            font-size: 0.9em;
            margin-bottom: 12px;
            color: #555;
        }

        .step-tools {
            font-size: 0.85em;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #e5e5e5;
            color: #888;
        }

        .step-tools::before {
            content: '→ ';
        }

        .tools-section {
            margin-top: 30px;
        }

        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .tool-card {
            padding: 28px;
            border-radius: 8px;
            transition: all 0.2s ease;
            cursor: pointer;
            background: #ffffff;
            border: 1px solid #d4d4d4;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .tool-card:hover {
            border-color: #666;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.12);
            transform: translateY(-2px);
        }

        .tool-icon {
            font-size: 2em;
            margin-bottom: 12px;
        }

        .tool-name {
            font-size: 1em;
            font-weight: 600;
            margin-bottom: 12px;
            color: #1a1a1a;
            font-family: 'Courier New', monospace;
        }

        .tool-desc {
            font-size: 0.9em;
            color: #555;
            line-height: 1.7;
            text-align: left;
        }

        .tool-desc strong {
            display: block;
            color: #1a1a1a;
            font-size: 1em;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .tool-tech {
            font-size: 0.85em;
            color: #888;
            margin-top: 16px;
            padding-top: 12px;
            border-top: 1px solid #e5e5e5;
            line-height: 1.6;
        }

        .flow-step {
            display: flex;
            align-items: center;
            gap: 20px;
            padding: 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            transition: all 0.3s;
        }

        .flow-step:hover {
            transform: translateX(10px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.12);
        }

        .flow-number {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            font-weight: bold;
            flex-shrink: 0;
            box-shadow: 0 4px 10px rgba(102, 126, 234, 0.3);
        }

        .flow-content {
            flex: 1;
        }

        .flow-tool {
            font-size: 1.2em;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 5px;
        }

        .flow-desc {
            font-size: 1em;
            color: #64748b;
            line-height: 1.6;
        }

        .flow-arrow-down {
            text-align: center;
            font-size: 2em;
            color: #667eea;
            font-weight: bold;
        }

        .external-section {
            margin-top: 60px;
            padding: 32px;
            background: #fafafa;
            border-radius: 8px;
            border: 1px solid #d4d4d4;
        }

        .external-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .external-card {
            padding: 24px;
            background: #ffffff;
            border-radius: 8px;
            border: 1px solid #d4d4d4;
            transition: all 0.2s ease;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .external-card:hover {
            border-color: #999;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.12);
        }

        .external-title {
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 12px;
            color: #1a1a1a;
        }

        .external-desc {
            font-size: 0.9em;
            color: #666;
            line-height: 1.7;
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 32px;
            margin-top: 60px;
            padding: 24px;
            background: #fafafa;
            border-radius: 8px;
            border: 1px solid #d4d4d4;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #666;
            font-size: 0.9em;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 3px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.2s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: #ffffff;
            margin: 3% auto;
            padding: 40px;
            border-radius: 8px;
            width: 85%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideIn 0.2s ease;
        }

        .modal-content::-webkit-scrollbar {
            width: 8px;
        }

        .modal-content::-webkit-scrollbar-track {
            background: #f0f0f0;
        }

        .modal-content::-webkit-scrollbar-thumb {
            background: #d4d4d4;
            border-radius: 4px;
        }

        .modal-content::-webkit-scrollbar-thumb:hover {
            background: #b8b8b8;
        }

        @keyframes slideIn {
            from { 
                transform: translateY(-20px); 
                opacity: 0; 
            }
            to { 
                transform: translateY(0); 
                opacity: 1; 
            }
        }

        .close {
            color: #999;
            float: right;
            font-size: 28px;
            font-weight: 300;
            cursor: pointer;
            transition: color 0.2s ease;
            line-height: 1;
        }

        .close:hover {
            color: #1a1a1a;
        }

        .modal-title {
            font-size: 1.8em;
            color: #1a1a1a;
            margin-bottom: 24px;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .modal-section {
            margin-bottom: 24px;
        }

        .modal-section-title {
            font-size: 1em;
            color: #1a1a1a;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .modal-text {
            font-size: 0.95em;
            color: #666;
            line-height: 1.8;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }

            h1 {
                font-size: 1.8em;
            }

            .split-container {
                grid-template-columns: 1fr;
            }

            .steps-grid {
                grid-template-columns: 1fr;
            }

            .tools-grid {
                grid-template-columns: 1fr;
            }

            .legend {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🚀 価格転嫁支援AI システム完全マップ</h1>
        <p class="subtitle">中小企業の価格交渉を成功に導く、3層エージェント・アーキテクチャ</p>

        <!-- ユーザーフロー -->
        <div class="flow-section">
            <div class="user-box">
                👤 ユーザー（中小企業経営者）<br>
                <small style="font-size: 0.8em; opacity: 0.9;">チャットUIで対話 (React/Next.js)</small>
            </div>

            <div class="arrow">↓</div>

            <div class="orchestrator-box">
                🧠 Orchestrator Agent（親エージェント・司令塔）<br>
                <small style="font-size: 0.8em; opacity: 0.9;">全リクエストの入り口。モード判定（キーワード+LLM推論）→ 適切な子エージェントへ振り分け</small>
            </div>

            <div class="arrow">↓</div>

            <div class="split-container">
                <div class="phase-box phase1">
                    <h3>📋 Mode 1 Agent（子エージェント）</h3>
                    <h4 style="font-size: 1.1em; margin-top: 12px; margin-bottom: 8px;">よろず相談エージェント</h4>
                    <p style="margin-top: 15px; font-size: 1em; line-height: 1.8;">
                        経営全般の幅広い相談に対応する汎用エージェント。<br>
                        価格転嫁以外の課題（資金繰り、人材採用、マーケティング等）を傾聴し、適切なアドバイスを提供。<br>
                        <strong>Web検索機能を標準搭載</strong>し、最新の市場動向や業界ニュース、統計データなどを取得可能。<br>
                        <strong>ステートレス（軽量）</strong>：複雑な状態管理は不要。
                    </p>
                </div>

                <div class="phase-box phase2">
                    <h3>💼 Mode 2 Agent（子エージェント）</h3>
                    <h4 style="font-size: 1.1em; margin-top: 12px; margin-bottom: 8px;">価格転嫁専門エージェント</h4>
                    <p style="margin-top: 15px; font-size: 1em; line-height: 1.8;">
                        価格交渉に特化した専門家エージェント。14ステップのプレイブック（CHECK 1-9 → STEP 1-5）に沿って、準備から実践まで徹底サポート。<br>
                        <strong>ステートフル（状態保持）</strong>：進捗データをセッションに保存し、モード切り替え後も復元可能。
                    </p>
                    <div style="margin-top: 20px; padding: 20px; background: rgba(255,255,255,0.15); border-radius: 12px; border-left: 4px solid #ffd700;">
                        <div style="font-weight: 700; font-size: 1.1em; margin-bottom: 10px;">🔄 Mode 2 Agentの動作</div>
                        <ol style="margin-left: 20px; line-height: 2; font-size: 0.95em;">
                            <li><strong>ステップ自動判定</strong>：会話履歴全体から現在のステップ（CHECK 1-9 / STEP 1-5）を自動判定</li>
                            <li><strong>ツール自動選択</strong>：判定されたステップに応じて、最適なツール（6つの専門ツール）を自動選択・起動</li>
                            <li><strong>進捗管理</strong>：完了したステップをセッションに記録し、継続的な支援を実現</li>
                            <li><strong>シームレス実行</strong>：ユーザーは対話を続けるだけで、裏側で専門ツールが連携動作</li>
                        </ol>
                    </div>
                    <p style="margin-top: 15px; font-size: 0.9em; opacity: 0.9; font-style: italic;">
                        例：「取引先の財務状況を知りたい」→ Mode 2 Agentがステップ判定（CHECK 6）→ company_researchツールを自動起動
                    </p>
                </div>
            </div>
        </div>

        <!-- 準備編 CHECK 1-9 -->
        <div class="flow-section">
            <div class="section-title">🟢 準備編: CHECK 1-9（外堀を埋める）</div>
            <div class="steps-grid">
                <div class="step-card check" onclick="showModal('check1')">
                    <div class="step-number">CHECK 1</div>
                    <div class="step-title">取引条件・業務内容の確認</div>
                    <div class="step-purpose">契約の曖昧さを排除</div>
                    <div class="step-tools">document_generator</div>
                </div>

                <div class="step-card check" onclick="showModal('check2')">
                    <div class="step-number">CHECK 2</div>
                    <div class="step-title">データの証拠化</div>
                    <div class="step-purpose">客観的データに変換</div>
                    <div class="step-tools">market_analysis</div>
                </div>

                <div class="step-card check" onclick="showModal('check3')">
                    <div class="step-number">CHECK 3</div>
                    <div class="step-title">精緻な原価計算</div>
                    <div class="step-purpose">正確なコスト構造を把握</div>
                    <div class="step-tools">analyze_cost_impact, search_knowledge_base</div>
                </div>

                <div class="step-card check" onclick="showModal('check4')">
                    <div class="step-number">CHECK 4</div>
                    <div class="step-title">戦略的単価表の作成</div>
                    <div class="step-purpose">自社定価を標準化</div>
                    <div class="step-tools">document_generator</div>
                </div>

                <div class="step-card check" onclick="showModal('check5')">
                    <div class="step-number">CHECK 5</div>
                    <div class="step-title">見積書フォーマット刷新</div>
                    <div class="step-purpose">価格転嫁の透明性確保</div>
                    <div class="step-tools">document_generator</div>
                </div>

                <div class="step-card check" onclick="showModal('check6')">
                    <div class="step-number">CHECK 6</div>
                    <div class="step-title">取引先の経営分析</div>
                    <div class="step-purpose">支払い能力と攻め筋を把握</div>
                    <div class="step-tools">company_research</div>
                </div>

                <div class="step-card check" onclick="showModal('check7')">
                    <div class="step-number">CHECK 7</div>
                    <div class="step-title">代替不可能性の言語化</div>
                    <div class="step-purpose">自社の強みを再定義</div>
                    <div class="step-tools">scenario_generator</div>
                </div>

                <div class="step-card check" onclick="showModal('check8')">
                    <div class="step-number">CHECK 8</div>
                    <div class="step-title">法令違反リスクチェック</div>
                    <div class="step-purpose">下請法違反の可能性を認識</div>
                    <div class="step-tools">search_knowledge_base</div>
                </div>

                <div class="step-card check important" onclick="showModal('check9')">
                    <div class="step-number">⭐ CHECK 9</div>
                    <div class="step-title">必達目標額の決定</div>
                    <div class="step-purpose">最低・希望転嫁額を明確化</div>
                    <div class="step-tools">analyze_cost_impact</div>
                </div>
            </div>
        </div>

        <!-- 実践編 STEP 1-5 -->
        <div class="flow-section">
            <div class="section-title">🟠 実践編: STEP 1-5（実際に動く）</div>
            <div class="steps-grid">
                <div class="step-card step" onclick="showModal('step1')">
                    <div class="step-number">STEP 1</div>
                    <div class="step-title">外堀を埋める</div>
                    <div class="step-purpose">業界・世論の空気作り</div>
                    <div class="step-tools">market_analysis</div>
                </div>

                <div class="step-card step" onclick="showModal('step2')">
                    <div class="step-number">STEP 2</div>
                    <div class="step-title">ターゲット選定</div>
                    <div class="step-purpose">勝率の高い相手から攻略</div>
                    <div class="step-tools">company_research</div>
                </div>

                <div class="step-card step" onclick="showModal('step3')">
                    <div class="step-number">STEP 3</div>
                    <div class="step-title">交渉の申し入れ</div>
                    <div class="step-purpose">決裁権者との商談時間確保</div>
                    <div class="step-tools">document_generator</div>
                </div>

                <div class="step-card step important" onclick="showModal('step4')">
                    <div class="step-number">⭐ STEP 4</div>
                    <div class="step-title">交渉本番</div>
                    <div class="step-purpose">納得ずくで値上げを承諾させる</div>
                    <div class="step-tools">scenario_generator, document_generator</div>
                </div>

                <div class="step-card step" onclick="showModal('step5')">
                    <div class="step-number">STEP 5</div>
                    <div class="step-title">アフターフォロー</div>
                    <div class="step-purpose">合意を契約書に落とし込む</div>
                    <div class="step-tools">document_generator</div>
                </div>
            </div>
        </div>

        <!-- 6つの専門ツール -->
        <div class="tools-section">
            <div class="section-title">🛠️ 6つの専門ツール</div>
            <div class="tools-grid">
                <div class="tool-card tool-1" onclick="showModal('tool1')">
                    <div class="tool-icon">📊</div>
                    <div class="tool-name">market_analysis</div>
                    <div class="tool-desc">
                        <strong>市場データ分析ツール</strong><br>
                        Web Search APIで政府統計サイト（e-Stat、日銀、厚労省）から最新の価格推移データを自動取得。企業物価指数、最低賃金、原材料価格の時系列データをグラフ化し、「感覚」ではなく「客観的証拠」で交渉を有利に進めます。予測モデルで今後の価格動向も提示可能。
                    </div>
                    <div class="tool-tech">使用タイミング: CHECK 2, STEP 1<br>Tech: Web Search API, Pandas, Matplotlib, NumPy</div>
                </div>

                <div class="tool-card tool-2" onclick="showModal('tool2')">
                    <div class="tool-icon">🔍</div>
                    <div class="tool-name">company_research</div>
                    <div class="tool-desc">
                        <strong>取引先調査ツール</strong><br>
                        Web検索で取引先の決算短信、IR情報、パートナーシップ構築宣言、CSR方針、最新ニュースを自動収集。財務状況を分析してS/A/B/Cランクで優先順位付け。増収増益なら強気、赤字なら段階的など、相手の懐具合に応じた最適な交渉戦略を提案します。
                    </div>
                    <div class="tool-tech">使用タイミング: CHECK 6, STEP 2<br>Tech: Web Search API, LLM (情報抽出・財務分析)</div>
                </div>

                <div class="tool-card tool-3" onclick="showModal('tool3')">
                    <div class="tool-icon">💰</div>
                    <div class="tool-name">analyze_cost_impact</div>
                    <div class="tool-desc">
                        <strong>コスト影響試算ツール</strong><br>
                        原価データから変動費・固定費を自動分類し、製品別の正確な原価を算出。損益分岐点シミュレーションで「これ以下では赤字」を数値化し、松竹梅の3プラン（最低/標準/希望）を生成。What-If分析で様々なシナリオを検証し、数学的根拠で「この金額が必要」を証明します。
                    </div>
                    <div class="tool-tech">使用タイミング: CHECK 3, CHECK 9（最重要）<br>Tech: NumPy, Pandas, RAG (計算式参照), Excel出力</div>
                </div>

                <div class="tool-card tool-4" onclick="showModal('tool4')">
                    <div class="tool-icon">🎭</div>
                    <div class="tool-name">scenario_generator</div>
                    <div class="tool-desc">
                        <strong>交渉シナリオ生成・訓練ツール</strong><br>
                        SWOT分析で自社の強み・弱みを客観視し、交渉シナリオを作成。AIが取引先役を演じるロールプレイで、「値上げは受け入れられない」「他社に切り替える」などの反論に対する対抗話法を練習。想定問答集と評価フィードバックで、自信を持って本番に臨めます。
                    </div>
                    <div class="tool-tech">使用タイミング: CHECK 7, STEP 4（最重要）<br>Tech: LLM (Multi-Agent), ロールプレイ評価エンジン</div>
                </div>

                <div class="tool-card tool-5" onclick="showModal('tool5')">
                    <div class="tool-icon">📄</div>
                    <div class="tool-name">document_generator</div>
                    <div class="tool-desc">
                        <strong>文書自動生成ツール</strong><br>
                        価格交渉申入書、見積書、説明資料、合意書など、あらゆる文書を数秒で自動生成。テンプレート+データ注入で、弁護士監修レベルの正式文書が完成。トーン調整（丁寧/標準/切実/毅然）で相手に応じた表現を選択可能。PDF/Word/Excel形式で即座に出力します。
                    </div>
                    <div class="tool-tech">使用タイミング: 全ステップで活躍<br>Tech: Jinja2, python-docx, openpyxl, PDF生成</div>
                </div>

                <div class="tool-card tool-6" onclick="showModal('tool6')">
                    <div class="tool-icon">⚖️</div>
                    <div class="tool-name">search_knowledge_base</div>
                    <div class="tool-desc">
                        <strong>法務知識検索ツール</strong><br>
                        RAGで下請法、独禁法、価格転嫁ハンドブック、労務費転嫁指針、公取委事例集を瞬時に検索。「これって違法？」に即答し、現在の取引が買いたたきに該当するかを判定。法的根拠を持って交渉に臨め、相手の不当な要求（一方的な値下げ要請等）に対して法律で対抗できます。
                    </div>
                    <div class="tool-tech">使用タイミング: CHECK 8, 随時<br>Tech: RAG (S3 + Vector Search), LLM (回答生成)</div>
                </div>
            </div>
        </div>

        <!-- 外部連携 -->
        <div class="external-section">
            <h2 style="text-align: center; margin-bottom: 12px; color: #1a1a1a; font-size: 1.6em; font-weight: 700;">🌐 外部連携 & データレイヤー</h2>
            <p style="text-align: center; color: #666; margin-bottom: 32px; font-size: 0.95em;">システムが利用する外部サービスとストレージ</p>
            <div class="external-grid">
                <div class="external-card">
                    <div class="external-title">🔍 Web Search API</div>
                    <div class="external-desc">
                        Google/Bing/Perplexity等を使用<br><br>
                        ✓ 市場データ検索（企業物価指数、最低賃金）<br>
                        ✓ 企業情報検索（決算短信、宣言）<br>
                        ✓ ニュース検索（業界動向、IR情報）<br>
                        ✓ 統計データ（e-Stat、厚労省）
                    </div>
                </div>

                <div class="external-card">
                    <div class="external-title">📚 RAG Service</div>
                    <div class="external-desc">
                        S3 + Vector Search<br><br>
                        ✓ 下請法全文<br>
                        ✓ 独占禁止法<br>
                        ✓ 価格転嫁ハンドブック<br>
                        ✓ 労務費転嫁指針<br>
                        ✓ 公取委事例集<br>
                        ✓ 原価計算モデル
                    </div>
                </div>

                <div class="external-card">
                    <div class="external-title">💾 S3 Storage</div>
                    <div class="external-desc">
                        セッション単位で管理<br><br>
                        ✓ 生成グラフ画像（PNG/SVG）<br>
                        ✓ 生成文書（PDF/Word/Excel）<br>
                        ✓ 会話履歴（24時間自動削除）<br>
                        ✓ アップロードファイル（見積書等）
                    </div>
                </div>
            </div>
        </div>

        <!-- 凡例 -->
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background: #10b981;"></div>
                <span>準備編 CHECK</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #f59e0b;"></div>
                <span>実践編 STEP</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #fbbf24;"></div>
                <span>★ 最重要ステップ</span>
            </div>
        </div>
    </div>

    <!-- モーダル -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <div id="modal-body"></div>
        </div>
    </div>

    <script>
        const modalData = {
            check1: {
                title: "CHECK 1: 取引条件・業務内容の確認",
                purpose: "契約の曖昧さを排除し、追加請求できる状態にする",
                details: "現在の取引条件を明確化し、「言った言わない」を防ぎます。業務範囲を可視化することで、追加作業に対する正当な請求根拠を作ります。",
                tools: "📄 document_generator: 業務フロー図作成、見積チェックリスト生成",
                usecase: "<strong>💬 ユースケース</strong><br>ユーザー：「取引先から『これも含まれてるよね？』と言われて、追加作業を無償でやらされることが多いんです」<br><br>AI：CHECK 1と判定 → document_generatorを起動<br>→ 現在の契約内容をヒアリングし、業務フロー図を自動作成<br>→ 「契約範囲内」と「追加作業」を明確に区分した見積チェックリストを生成<br>→ 今後は追加作業に対して正当に請求できる体制が整う"
            },
            check2: {
                title: "CHECK 2: 原材料費・労務費データの証拠化",
                purpose: "「なんとなく上がった」を「客観的データ」に変換",
                details: "政府統計（e-Stat、日銀、厚労省）から公式データを取得し、価格推移グラフを生成。「感覚」ではなく「事実」で交渉します。",
                tools: "📊 market_analysis: 企業物価指数取得、最低賃金データ取得、価格推移グラフ生成、予測モデル",
                usecase: "<strong>💬 ユースケース</strong><br>ユーザー：「ステンレスの価格が上がってるから値上げしたいんだけど、どう説明すればいいかな」<br><br>AI：CHECK 2と判定 → market_analysisを起動<br>→ e-Statから企業物価指数（ステンレス）の過去3年分のデータを自動取得<br>→ 価格推移グラフを生成（2021年比+35%上昇を可視化）<br>→ 「政府統計で証明された客観的事実」として交渉資料が完成"
            },
            check3: {
                title: "CHECK 3: 精緻な原価計算の実施",
                purpose: "製品1個あたりの正確なコスト構造を把握",
                details: "変動費・固定費を分類し、製品別の正確な原価を算出。赤字製品を特定し、適正価格を数値で示します。",
                tools: "⚖️ search_knowledge_base: 原価計算手法のレクチャー（業種別モデル提示）<br>💰 analyze_cost_impact: 変動費・固定費の分類、配賦計算、製品別原価算出",
                usecase: "<strong>💬 ユースケース</strong><br>ユーザー：「正直、製品ごとの原価がよくわかってないんだよね...」<br><br>AI：CHECK 3と判定 → search_knowledge_baseで原価計算手法を検索 → analyze_cost_impactを起動<br>→ 対話形式で原材料費、労務費、経費をヒアリング<br>→ 変動費・固定費を自動分類し、製品A/B/Cそれぞれの原価を算出<br>→ 「製品Bは実は赤字だった」という事実が判明し、優先的に値上げすべき製品が明確に"
            },
            check4: {
                title: "CHECK 4: 戦略的単価表の作成",
                purpose: "標準化された「自社定価」を持つ",
                details: "部品別・工程別・スキルレベル別の標準単価表を作成。値引き交渉ではなく、「定価からの調整」という立場を確立します。",
                tools: "📄 document_generator: 部品別・工程別・スキルレベル別の標準単価表フォーマット生成",
                usecase: "<strong>💬 ユースケース</strong><br>ユーザー：「毎回、相手の言い値で決まってしまって...」<br><br>AI：CHECK 4と判定 → document_generatorを起動<br>→ CHECK 3で算出した原価データを元に、適正利益率を加味した標準単価表を自動生成<br>→ 部品A: 5,000円、工程B: 8,000円/時間、といった「自社定価」が確立<br>→ 今後は「定価から10%引き」という交渉スタイルに転換可能"
            },
            check5: {
                title: "CHECK 5: 「中身の見える」見積書フォーマットへの刷新",
                purpose: "コスト費目を明記し、価格転嫁の透明性を確保",
                details: "中小企業庁ハンドブック準拠の見積書様式を採用。原材料費・労務費・経費を明記し、値上げの正当性を可視化します。",
                tools: "📄 document_generator: コスト費目別見積書（中小企業庁ハンドブック準拠様式）",
                usecase: "<strong>💬 ユースケース</strong><br>ユーザー：「見積書に『一式 50万円』としか書いてなくて、値上げの説明がしづらい」<br><br>AI：CHECK 5と判定 → document_generatorを起動<br>→ 中小企業庁ハンドブック準拠の「コスト費目別見積書」フォーマットを生成<br>→ 原材料費: 20万円、労務費: 25万円、経費: 5万円、と内訳を明記<br>→ 「原材料費が3万円上がったので、合計53万円になります」と透明性のある説明が可能に"
            },
            check6: {
                title: "CHECK 6: 敵を知る（取引先の経営分析）",
                purpose: "相手の「支払い能力」と「建前」を把握し、攻め筋を決める",
                details: "決算情報、パートナーシップ構築宣言、CSR方針を分析。増収増益なら強気、赤字なら段階的など、相手に応じた戦略を立案します。",
                tools: "🔍 company_research: 決算情報取得、パートナーシップ構築宣言確認、CSR方針分析、財務状況分析、経営陣プロファイリング",
                usecase: "<strong>💬 ユースケース</strong><br>ユーザー：「A社とB社、どちらから交渉すべきか迷ってる」<br><br>AI：CHECK 6と判定 → company_researchを起動<br>→ A社: 増収増益、パートナーシップ宣言済み → Sランク（成功率90%）<br>→ B社: 減収減益、宣言なし → Cランク（成功率30%）<br>→ 「A社から交渉し、成功事例を作ってからB社に臨むべき」と戦略を提案"
            },
            check7: {
                title: "CHECK 7: 自社の「代替不可能性」の言語化",
                purpose: "「あなたじゃなきゃ困る」と思わせる強みを再定義",
                details: "SWOT分析で自社の強みを客観視。技術力、納期対応力、品質など、他社に真似できない価値を明確化し、交渉カードにします。",
                tools: "🎭 scenario_generator: SWOT分析、強みの言語化、バーター条件生成、Value Proposition構築",
                usecase: "<strong>💬 ユースケース</strong><br>ユーザー：「うちの強みって何だろう...他社でもできそうな気がして」<br><br>AI：CHECK 7と判定 → scenario_generatorを起動<br>→ 対話形式でSWOT分析を実施<br>→ 強み: 「48時間以内の緊急対応」「不良率0.1%の高品質」「20年の信頼関係」を抽出<br>→ 「他社に切り替えるとリードタイムが2週間かかり、品質リスクも高まる」というValue Propositionを構築"
            },
            check8: {
                title: "CHECK 8: 法令違反（買いたたき）リスクのチェック",
                purpose: "現在の取引が下請法違反の可能性があることを認識",
                details: "下請法・独禁法に照らし合わせ、現在の取引条件が「買いたたき」に該当するかを判定。法的根拠を持って交渉に臨めます。",
                tools: "⚖️ search_knowledge_base: 下請法違反判定、独占禁止法ガイドライン照合、リスクアラート、公取委事例検索",
                usecase: "<strong>💬 ユースケース</strong><br>ユーザー：「原材料費が20%上がったのに、取引先は『価格据え置きで』と言ってくる」<br><br>AI：CHECK 8と判定 → search_knowledge_baseを起動<br>→ 下請法第4条第1項第5号「買いたたき」に該当する可能性が高いと判定<br>→ 公取委の勧告事例を提示し、「通常の対価を大幅に下回る額を定めることは違法」と法的根拠を明示<br>→ 「法律上、適正な価格転嫁を要請する権利がある」という自信を獲得"
            },
            check9: {
                title: "⭐ CHECK 9: 必達目標額の決定（最重要）",
                purpose: "自社の生存に必要な「最低転嫁額」と「希望転嫁額」を明確化",
                details: "損益分岐点シミュレーションで「これ以下では赤字」を数値化。松竹梅の3プランを用意し、交渉の落としどころを事前に設定します。",
                tools: "💰 analyze_cost_impact: 損益分岐点シミュレーション、松竹梅プラン生成、What-If分析、キャッシュフロー影響試算",
                usecase: "<strong>💬 ユースケース</strong><br>ユーザー：「いくら値上げすればいいのか、正直わからない」<br><br>AI：CHECK 9と判定 → analyze_cost_impactを起動<br>→ CHECK 2のデータ（原材料費+20%）とCHECK 3の原価構造を統合<br>→ 松: 15%値上げ（希望）、竹: 10%値上げ（標準）、梅: 5%値上げ（最低限）の3プランを生成<br>→ 「梅プランでも利益率3%確保、松プランなら設備投資も可能」とシミュレーション結果を提示<br>→ 交渉の落としどころが明確になり、自信を持って臨める"
            },
            step1: {
                title: "STEP 1: 外堀を埋める（業界・世論の空気作り）",
                purpose: "「値上げは社会的な要請」という空気を作る",
                details: "同業他社の値上げニュース、業界団体の声明文を収集。「うちだけじゃない、業界全体の動き」という文脈を作り、心理的抵抗を下げます。",
                tools: "📊 market_analysis: 同業他社の値上げニュース収集、業界団体の声明文検索、業界全体トレンド分析",
                usecase: "<strong>💬 ユースケース</strong><br>ユーザー：「いよいよ交渉を始めたいけど、『うちだけ』と思われたくない」<br><br>AI：STEP 1と判定 → market_analysisを起動<br>→ 同業他社の値上げニュース（大手3社が平均12%値上げ）を収集<br>→ 業界団体の声明文（「適正な価格転嫁を推奨」）を検索<br>→ 「業界全体で値上げが進んでいる」という資料を作成<br>→ 交渉時に「業界の動きに合わせた対応」として説明可能に"
            },
            step2: {
                title: "STEP 2: ターゲット選定と優先順位付け",
                purpose: "勝率の高い相手から攻略し、実績を作る",
                details: "取引先をS/A/B/Cランクに分類。パートナーシップ宣言企業や増益企業から交渉し、成功事例を作って他社への説得材料にします。",
                tools: "🔍 company_research: 取引先リストの分析、S/A/B/Cランク付け、成功率予測、交渉順序の提案",
                usecase: "<strong>💬 ユースケース</strong><br>ユーザー：「5社に値上げ交渉したいけど、どの順番で行くべき？」<br><br>AI：STEP 2と判定 → company_researchを起動（CHECK 6のデータを活用）<br>→ A社（Sランク）: パートナーシップ宣言済み、増益 → 1番目<br>→ B社（Aランク）: 宣言なしだが増益 → 2番目<br>→ C社（Cランク）: 減益、厳しい交渉予想 → 5番目<br>→ 「A社で成功事例を作り、『A社も承諾してくれました』とB社以降に伝える戦略」を提案"
            },
            step3: {
                title: "STEP 3: 交渉の申し入れ（アポイントメント）",
                purpose: "門前払いを回避し、決裁権者との正式な商談時間を確保",
                details: "丁寧/標準/切実/毅然の4トーンから選択し、相手に応じた申入書を作成。「お願い」ではなく「協議」の姿勢で臨みます。",
                tools: "📄 document_generator: 価格交渉申入書作成、トーン＆マナー調整（丁寧/標準/切実/毅然）",
                usecase: "<strong>💬 ユースケース</strong><br>ユーザー：「A社の社長にアポを取りたい。どんな文面がいい？」<br><br>AI：STEP 3と判定 → document_generatorを起動<br>→ A社の特性（パートナーシップ宣言企業）を考慮し、「丁寧」トーンを選択<br>→ 「価格改定のご協議のお願い」という件名で、法的根拠と業界動向を簡潔に記載した申入書を生成<br>→ 「お願い」ではなく「協議」という対等な姿勢で、決裁権者（社長）との面談を要請<br>→ メール送信後、3日以内に返信がなければフォローアップの提案も"
            },
            step4: {
                title: "⭐ STEP 4: 交渉本番（最重要）",
                purpose: "準備した資料とロジックを駆使し、納得ずくで値上げを承諾させる",
                details: "グラフ、試算表、見積書を統合したプレゼン資料で説得。AIロールプレイで練習した想定問答で、あらゆる反論に対応します。",
                tools: "📄 document_generator: 根拠資料セット統合（グラフ+試算表+見積書）、プレゼン資料生成<br>🎭 scenario_generator: 交渉シナリオ作成、想定問答集生成、ロールプレイ訓練",
                usecase: "<strong>💬 ユースケース</strong><br>ユーザー：「明日がA社との交渉本番...緊張する」<br><br>AI：STEP 4と判定 → scenario_generator + document_generatorを起動<br>→ AIが「A社社長役」を演じるロールプレイを実施<br>→ 「他社に切り替えるぞ」という反論に対し、CHECK 7の強み（緊急対応力）で対抗する練習<br>→ プレゼン資料を自動生成（グラフ、試算表、見積書を統合）<br>→ 想定問答集（10パターン）と評価フィードバックで、自信を持って本番に臨める<br>→ 結果: 10%値上げで合意成立！"
            },
            step5: {
                title: "STEP 5: アフターフォロー & 発注後の微調整",
                purpose: "合意内容を確実に契約書に落とし込み、スポット案件での取りこぼしを防ぐ",
                details: "口頭合意を文書化し、仕様変更時の追加見積も即座に生成。「言った言わない」を防ぎ、継続的な適正価格を維持します。",
                tools: "📄 document_generator: 合意書作成、確定見積書、仕様変更見積書の即時生成",
                usecase: "<strong>💬 ユースケース</strong><br>ユーザー：「A社と10%値上げで口頭合意したけど、これで終わり？」<br><br>AI：STEP 5と判定 → document_generatorを起動<br>→ 口頭合意を文書化した「価格改定合意書」を自動生成<br>→ 「2025年1月1日より、従来価格の110%で取引する」と明記<br>→ さらに、スポット案件用の「仕様変更見積書」テンプレートも準備<br>→ 今後、「ちょっと仕様変えて」と言われても、即座に追加見積を提示できる体制が整う<br>→ 継続的な適正価格を維持し、取りこぼしを防ぐ"
            },
            tool1: {
                title: "📊 market_analysis（市場データ分析ツール）",
                purpose: "客観的証拠で交渉を有利に進める",
                details: "Web Search APIで政府統計サイト（e-Stat、日銀、厚労省）から最新データを取得。企業物価指数、最低賃金、原材料価格の推移をグラフ化し、「感覚」ではなく「データ」で説得します。予測モデルで今後の価格動向も提示可能。",
                tech: "Web Search API, Pandas, Matplotlib, NumPy"
            },
            tool2: {
                title: "🔍 company_research（取引先調査ツール）",
                purpose: "相手を知り、最適な交渉戦略を立案",
                details: "Web検索で取引先の決算短信、IR情報、パートナーシップ構築宣言、CSR方針、ニュースを収集。財務状況を分析し、S/A/B/Cランクで優先順位付け。増収増益なら強気、赤字なら段階的など、相手に応じた戦略を提案します。",
                tech: "Web Search API, LLM (情報抽出・分析), 財務分析アルゴリズム"
            },
            tool3: {
                title: "💰 analyze_cost_impact（コスト試算ツール）",
                purpose: "数学的根拠で「この金額が必要」を証明",
                details: "原価データから変動費・固定費を分類し、製品別の正確な原価を算出。損益分岐点シミュレーションで「最低転嫁額」を計算し、松竹梅の3プランを生成。What-If分析で様々なシナリオを検証し、最適な価格改定案を提示します。",
                tech: "NumPy, Pandas, RAG (計算式参照), Excel出力, Monte Carlo Simulation"
            },
            tool4: {
                title: "🎭 scenario_generator（交渉訓練ツール）",
                purpose: "本番前にAIで予行演習、成功率を最大化",
                details: "SWOT分析で自社の強み・弱みを整理し、交渉シナリオを作成。AIが取引先役を演じるロールプレイで、想定問答を練習。「値上げは受け入れられない」「他社に切り替える」などの反論に対する対抗話法を習得し、自信を持って本番に臨めます。",
                tech: "LLM (Multi-Agent), ロールプレイ評価エンジン, SWOT分析"
            },
            tool5: {
                title: "📄 document_generator（文書自動生成ツール）",
                purpose: "プロレベルの文書を数秒で作成",
                details: "価格交渉申入書、見積書、説明資料、合意書など、あらゆる文書を自動生成。テンプレート+データ注入で、弁護士監修レベルの正式文書が完成。トーン調整（丁寧/標準/切実/毅然）で相手に応じた表現を選択可能。PDF/Word/Excel形式で出力。",
                tech: "Jinja2 (テンプレートエンジン), python-docx, openpyxl, PDF生成ライブラリ"
            },
            tool6: {
                title: "⚖️ search_knowledge_base（法務知識検索ツール）",
                purpose: "法的根拠で交渉を後押し",
                details: "RAGで下請法、独禁法、価格転嫁ハンドブック、労務費転嫁指針、公取委事例集を検索。「これって違法？」に即答し、現在の取引が買いたたきに該当するかを判定。法的根拠を持って交渉に臨め、相手の不当な要求に対抗できます。",
                tech: "RAG (S3 + Vector Search), LLM (回答生成), セマンティック検索"
            }
        };

         function showModal(id) {
             const data = modalData[id];
             const modal = document.getElementById('modal');
             const modalBody = document.getElementById('modal-body');

             let usecaseSection = '';
             if (data.usecase) {
                 usecaseSection = `
                     <div class="modal-section">
                         <div class="modal-section-title">💡 ユースケース</div>
                         <div class="modal-text" style="background: #f8f9fa; padding: 15px; border-radius: 10px; border-left: 4px solid #667eea;">${data.usecase}</div>
                     </div>
                 `;
             }

             modalBody.innerHTML = `
                 <h2 class="modal-title">${data.title}</h2>
                 <div class="modal-section">
                     <div class="modal-section-title">🎯 目的</div>
                     <div class="modal-text">${data.purpose}</div>
                 </div>
                 <div class="modal-section">
                     <div class="modal-section-title">📋 詳細</div>
                     <div class="modal-text">${data.details}</div>
                 </div>
                 <div class="modal-section">
                     <div class="modal-section-title">🛠️ 使用ツール${data.tech ? ' / 技術' : ''}</div>
                     <div class="modal-text">${data.tools || data.tech}</div>
                 </div>
                 ${usecaseSection}
             `;

             modal.style.display = 'block';
         }

        function closeModal() {
            document.getElementById('modal').style.display = 'none';
        }

        // モーダル外クリックで閉じる
        window.onclick = function(event) {
            const modal = document.getElementById('modal');
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        }

        // ESCキーで閉じる
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeModal();
            }
        });
    </script>
</body>
</html>

